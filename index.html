<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hero's Awakening RPG</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap');
        
        /* Usar 100dvh para móviles evita problemas con la barra de direcciones */
        body { font-family: 'Roboto', sans-serif; background-color: #0f172a; color: #e2e8f0; height: 100dvh; }
        .font-game { font-family: 'Orbitron', sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 12px; transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .btn-secondary { background: #334155; }
        
        /* Animaciones */
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Custom Scrollbar for profile history */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="h-[100dvh] flex flex-col max-w-md mx-auto shadow-2xl overflow-hidden relative bg-slate-900">

    <!-- Toast Notification Container (Fixed Top) -->
    <div id="toastContainer" class="fixed top-4 left-4 right-4 z-50 flex flex-col items-center pointer-events-none gap-2"></div>

    <!-- Custom Modal Overlay (Hidden by default) -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0" aria-hidden="true">
        <div id="modalContent" class="bg-slate-800 border border-slate-600 rounded-xl p-6 max-w-sm w-full shadow-2xl transform scale-95 transition-all">
            <h3 id="modalTitle" class="text-xl font-bold text-white mb-2 font-game">Confirmar</h3>
            <p id="modalMessage" class="text-slate-300 mb-6 text-sm leading-relaxed">¿Estás seguro?</p>
            <div class="flex justify-end space-x-3">
                <button id="modalCancelBtn" class="px-4 py-2 rounded text-slate-400 hover:text-white text-sm font-medium hover:bg-slate-700 transition-colors">Cancelar</button>
                <button id="modalConfirmBtn" class="px-5 py-2 rounded bg-indigo-600 text-white font-bold text-sm hover:bg-indigo-500 shadow-lg shadow-indigo-500/30 transition-all transform hover:-translate-y-0.5">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Header / Stats Bar -->
    <header class="bg-slate-900/95 backdrop-blur p-4 border-b border-slate-700 z-10 flex-none">
        <div class="flex justify-between items-center mb-3">
            <div>
                <h1 class="font-game text-xl text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">HERO'S AWAKENING</h1>
                <p class="text-xs text-slate-400 flex items-center gap-1">
                    <i data-lucide="shield" class="w-3 h-3"></i> Nivel <span id="userLevel" class="text-white font-bold">1</span> • <span id="userTitle">Novato</span>
                </p>
            </div>
            <div class="text-right">
                <div class="text-[10px] text-yellow-400 font-bold uppercase tracking-wider mb-1">Experiencia</div>
                <div class="w-28 h-3 bg-slate-800 rounded-full border border-slate-700 relative overflow-hidden">
                    <div id="xpBar" class="h-full bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-full transition-all duration-500" style="width: 0%"></div>
                    <div class="absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white drop-shadow-md">
                        <span id="currentXp">0</span> / <span id="nextLevelXp">500</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Stats Grid -->
        <div class="grid grid-cols-4 gap-2 text-center text-xs">
            <div class="bg-slate-800/50 p-2 rounded border border-slate-700/50"><span class="block text-red-400 font-bold text-sm" id="statStr">0</span>Fuerza</div>
            <div class="bg-slate-800/50 p-2 rounded border border-slate-700/50"><span class="block text-green-400 font-bold text-sm" id="statAgi">0</span>Agilidad</div>
            <div class="bg-slate-800/50 p-2 rounded border border-slate-700/50"><span class="block text-blue-400 font-bold text-sm" id="statInt">0</span>Intel.</div>
            <div class="bg-slate-800/50 p-2 rounded border border-slate-700/50"><span class="block text-purple-400 font-bold text-sm" id="statCha">0</span>Carisma</div>
        </div>
    </header>

    <!-- Main Content Area -->
    <!-- 'flex-1' para ocupar el espacio restante y 'pb-32' para padding de seguridad -->
    <main class="flex-1 overflow-y-auto p-4 space-y-6 scroll-smooth" id="appContent">
        <!-- Se inyecta contenido dinámicamente aquí -->
    </main>

    <!-- Navigation -->
    <!-- 'absolute' en lugar de 'fixed' relativo al contenedor body -->
    <nav class="bg-slate-900/95 backdrop-blur p-2 pb-6 pt-3 border-t border-slate-700 absolute bottom-0 w-full z-20 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
        <div class="flex justify-around">
            <button onclick="renderMissions()" class="nav-btn flex flex-col items-center text-indigo-400 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-slate-800 transition"><i data-lucide="sword" class="w-6 h-6"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Misiones</span>
            </button>
            <button onclick="renderMentor()" class="nav-btn flex flex-col items-center text-slate-400 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-slate-800 transition"><i data-lucide="bot" class="w-6 h-6"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Mentor</span>
            </button>
            <button onclick="renderProfile()" class="nav-btn flex flex-col items-center text-slate-400 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-slate-800 transition"><i data-lucide="user" class="w-6 h-6"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Perfil</span>
            </button>
        </div>
    </nav>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA & STATE ---
        const GAME_DATA = {
            missions: [
                { id: 1, title: "El Espejo de la Verdad", ref: "Capítulo 2", desc: "Mírate al espejo y di en voz alta 3 fortalezas tuyas. Escríbelas después.", type: "daily", xp: 100, stat: "Cha", color: "border-purple-500", text_color: "text-purple-400" },
                { id: 2, title: "Caza de Villanos: La Queja", ref: "Capítulo 6", desc: "Detecta a alguien quejándose. Escucha 2 min sin juzgar y retírate amablemente.", type: "combat", xp: 150, stat: "Str", color: "border-red-500", text_color: "text-red-400" },
                { id: 3, title: "Diálogo Interno", ref: "Capítulo 5", desc: "Identifica un pensamiento negativo ('no puedo') y cámbialo por uno positivo ('voy a intentar').", type: "mental", xp: 120, stat: "Int", color: "border-blue-500", text_color: "text-blue-400" },
                { id: 4, title: "Observador Silencioso", ref: "Capítulo 3", desc: "En una reunión o cena, escucha el doble de lo que hables.", type: "stealth", xp: 200, stat: "Agi", color: "border-green-500", text_color: "text-green-400" },
                { id: 5, title: "Saluda con Propósito", ref: "Capítulo 4", desc: "Saluda a 3 desconocidos o compañeros con los que no sueles hablar. Sonríe genuinamente.", type: "daily", xp: 130, stat: "Cha", color: "border-yellow-500", text_color: "text-yellow-400" },
                { id: 6, title: "No Supongas", ref: "Capítulo 6", desc: "Si dudas de la intención de alguien, pregúntale directamente en lugar de suponer.", type: "mental", xp: 140, stat: "Int", color: "border-indigo-500", text_color: "text-indigo-400" }
            ],
            mentorQuotes: {
                fail: [ 
                    "Recuerda el axioma del Cap. 6: No hay errores, solo aprendizaje. ¿Qué te ha enseñado esto?",
                    "Fracaso + Triunfo = Aprendizaje. Acéptalo, analízalo y sigue. No te estanques en la culpa.",
                    "El héroe no es quien siempre gana, es quien siempre se levanta. Revisa tu estrategia.",
                    "Si no te equivocas, es que no estás saliendo de tu zona de confort. ¡Bien hecho por intentarlo!",
                    "Tu 'villano interior' (el ego) quiere que te rindas por vergüenza. No le des ese gusto.",
                    "Analiza la situación como un observador externo (Tercera persona). ¿Qué le aconsejarías a un amigo que falló en esto?",
                    "Hasta el Capitán Sully fue cuestionado al principio. Confía en tu instinto y sigue practicando.",
                    "La resiliencia es el músculo que estás entrenando ahora mismo. Duele porque está creciendo.",
                    "No te fustigues. La culpa paraliza, la responsabilidad moviliza. ¿Qué harás diferente la próxima vez?",
                    "El éxito es ir de fracaso en fracaso sin perder el entusiasmo. ¡Arriba ese ánimo, héroe!",
                    "Como dice Maite: 'No importa cuán difíciles sean las circunstancias, siempre tienes la libertad de elegir cómo respondes'."
                ],
                fear: [ 
                    "El miedo es la señal inequívoca de que estás saliendo de tu zona de confort. ¡Es una buena señal!",
                    "Hazlo con miedo, pero hazlo. Tu héroe interior te espera justo al otro lado de esa barrera.",
                    "Recuerda a Alice Herz-Sommer: ella elegía ver lo bueno incluso en un campo de concentración. Tú eliges tu actitud hoy.",
                    "El miedo escénico es normal (90% lo sufre). Transforma esa adrenalina en pasión por tu mensaje.",
                    "No escuches a los 'villanos' externos que te dicen 'eso no tiene salida'. Escucha a tu propósito.",
                    "La valentía no es la ausencia de miedo, es la capacidad de actuar a pesar de él.",
                    "Tu diálogo interno define tu realidad. ¿Qué te estás diciendo ahora mismo? ¿Te limitas o te potencias?",
                    "Visualiza el éxito con detalle. Tu cerebro no distingue entre realidad e imaginación vívida.",
                    "Estás en el 'punto de no retorno' del viaje del héroe. Solo queda ir hacia adelante con confianza.",
                    "¿Qué es lo peor que puede pasar? ¿Y lo mejor? Generalmente, lo mejor pesa más.",
                    "La incertidumbre es el terreno de juego del líder. Respira hondo y da el primer paso."
                ],
                tips: [ 
                    "Regla de oro de la comunicación: Escuchar, Preguntar, Hablar. En ese orden estricto.",
                    "Somos animales sociales. Busca siempre lo que te une al otro (valores), no lo que te separa.",
                    "Tu cuerpo comunica antes que tu boca. Revisa tu postura: hombros atrás, mirada al frente.",
                    "La empatía es tu arma más poderosa. Intenta ver el mundo desde las gafas de tu interlocutor.",
                    "Liderar es servir. Pregúntate: ¿A quién puedo ayudar o inspirar hoy?",
                    "Una palabra dicha a destiempo puede romper una relación. Pausa antes de reaccionar emocionalmente.",
                    "La autenticidad conecta más que la perfección. No temas mostrarte humano.",
                    "Si quieres ser interesante, interésate primero genuinamente por los demás.",
                    "El mapa no es el territorio. Abre tu mente a otras perspectivas sin juzgarlas de inmediato.",
                    "La perseverancia vence al talento cuando el talento no se esfuerza. Sigue picando piedra.",
                    "Prioriza: No todo es urgente. Enfócate en lo que te acerca a tu propósito (Cap. 7)."
                ]
            }
        };

        let gameState = JSON.parse(localStorage.getItem('heroRPG_save')) || {
            xp: 0,
            level: 1,
            stats: { Str: 1, Agi: 1, Int: 1, Cha: 1 },
            completedMissions: [],
            lastLogin: new Date().toDateString()
        };

        // --- COMMON FOOTER ---
        const FOOTER_HTML = `
            <div class="text-center pt-8 pb-32 opacity-30 hover:opacity-80 transition-opacity duration-500 cursor-default select-none">
                <p class="text-[9px] text-slate-500 font-game mb-1 tracking-widest">v1.0.0-beta</p>
                <p class="text-[9px] text-slate-600 font-medium">Derechos reservados Liderapia y Dra. Maite Moyá 2026</p>
            </div>
        `;

        // --- UI UTILS (MODAL & TOAST) ---
        
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const bgClass = type === 'success' ? 'bg-green-600' : (type === 'levelup' ? 'bg-yellow-600' : 'bg-red-600');
            const icon = type === 'success' ? 'check-circle' : (type === 'levelup' ? 'trophy' : 'alert-circle');

            toast.className = `${bgClass} text-white px-4 py-3 rounded-lg shadow-xl flex items-center gap-3 min-w-[300px] slide-up pointer-events-auto border border-white/10`;
            toast.innerHTML = `
                <i data-lucide="${icon}" class="w-5 h-5 flex-shrink-0"></i>
                <span class="text-sm font-bold">${message}</span>
            `;
            
            container.appendChild(toast);
            lucide.createIcons();

            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function toggleModal(show) {
            const overlay = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            if (show) {
                overlay.classList.remove('hidden');
                setTimeout(() => {
                    overlay.classList.remove('opacity-0');
                    content.classList.remove('scale-95');
                    content.classList.add('scale-100');
                }, 10);
            } else {
                overlay.classList.add('opacity-0');
                content.classList.remove('scale-100');
                content.classList.add('scale-95');
                setTimeout(() => overlay.classList.add('hidden'), 200);
            }
        }

        function showConfirmation(title, message, onConfirm) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerText = message;
            
            const confirmBtn = document.getElementById('modalConfirmBtn');
            const cancelBtn = document.getElementById('modalCancelBtn');

            const newConfirm = confirmBtn.cloneNode(true);
            const newCancel = cancelBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirm, confirmBtn);
            cancelBtn.parentNode.replaceChild(newCancel, cancelBtn);

            newConfirm.onclick = () => {
                onConfirm();
                toggleModal(false);
            };

            newCancel.onclick = () => {
                toggleModal(false);
            };

            toggleModal(true);
        }

        // --- CORE FUNCTIONS ---

        function saveGame() {
            localStorage.setItem('heroRPG_save', JSON.stringify(gameState));
            updateUI();
        }

        function updateUI() {
            const nextLevel = gameState.level * 500;
            const percentage = (gameState.xp / nextLevel) * 100;

            document.getElementById('userLevel').innerText = gameState.level;
            document.getElementById('currentXp').innerText = gameState.xp;
            document.getElementById('nextLevelXp').innerText = nextLevel;
            document.getElementById('xpBar').style.width = `${Math.min(percentage, 100)}%`;
            
            const titles = ["Novato", "Aprendiz", "Explorador", "Guerrero", "Líder", "Héroe"];
            const titleIndex = Math.min(gameState.level - 1, titles.length - 1);
            document.getElementById('userTitle').innerText = titles[titleIndex];

            document.getElementById('statStr').innerText = gameState.stats.Str;
            document.getElementById('statAgi').innerText = gameState.stats.Agi;
            document.getElementById('statInt').innerText = gameState.stats.Int;
            document.getElementById('statCha').innerText = gameState.stats.Cha;

            if (gameState.xp >= nextLevel) {
                gameState.level++;
                gameState.xp = gameState.xp - nextLevel;
                showToast(`¡NIVEL ${gameState.level} ALCANZADO!`, 'levelup');
                saveGame();
            }
        }

        function completeMission(id) {
            const mission = GAME_DATA.missions.find(m => m.id === id);
            if (!mission) return;

            showConfirmation(
                "¿Completar Misión?", 
                `Confirma con honestidad que has cumplido: "${mission.title}". El héroe no se engaña a sí mismo.`,
                () => {
                    gameState.xp += mission.xp;
                    if(gameState.stats[mission.stat] !== undefined) {
                        gameState.stats[mission.stat] += 1;
                    }
                    gameState.completedMissions.push({id: id, date: new Date().toDateString()});
                    
                    showToast(`¡Misión Cumplida! +${mission.xp} XP y +1 ${mission.stat}`);
                    saveGame();
                    renderMissions();
                }
            );
        }

        // --- RENDERING ---

        function renderMissions() {
            const container = document.getElementById('appContent');
            container.innerHTML = `
                <div class="flex items-center gap-2 mb-4 fade-in">
                    <h2 class="font-game text-lg text-white">Misiones Disponibles</h2>
                    <span class="text-xs bg-slate-700 text-slate-300 px-2 py-0.5 rounded-full">Hoy</span>
                </div>
            `;

            GAME_DATA.missions.forEach((mission, index) => {
                const completedToday = gameState.completedMissions.some(cm => cm.id === mission.id && cm.date === new Date().toDateString());
                
                const card = document.createElement('div');
                card.className = `card p-5 mb-4 border-l-4 ${mission.color} ${completedToday ? 'opacity-50 grayscale' : 'hover:shadow-lg shadow-md'} relative overflow-hidden fade-in`;
                card.style.animationDelay = `${index * 100}ms`;
                
                card.innerHTML = `
                    <div class="absolute top-0 right-0 p-2 opacity-10">
                        <i data-lucide="${completedToday ? 'check-circle' : 'target'}" class="w-24 h-24"></i>
                    </div>
                    <div class="flex justify-between items-start relative z-10">
                        <div>
                            <span class="text-[10px] font-bold uppercase tracking-widest ${mission.text_color} mb-1 block">${mission.ref}</span>
                            <h3 class="font-bold text-white text-lg leading-tight">${mission.title}</h3>
                        </div>
                        <div class="bg-slate-900/80 backdrop-blur px-2 py-1 rounded text-xs text-yellow-500 font-bold border border-yellow-500/20 whitespace-nowrap ml-2">+${mission.xp} XP</div>
                    </div>
                    <p class="text-sm text-slate-300 mt-3 leading-relaxed relative z-10">${mission.desc}</p>
                    <div class="mt-4 flex justify-between items-center relative z-10 pt-3 border-t border-slate-700/50">
                        <div class="flex items-center text-xs text-slate-400 font-medium">
                            <i data-lucide="zap" class="w-3 h-3 mr-1 ${mission.text_color}"></i>
                            +1 ${mission.stat}
                        </div>
                        ${completedToday 
                            ? '<span class="text-green-500 text-sm font-bold flex items-center bg-green-500/10 px-3 py-1 rounded-full"><i data-lucide="check" class="w-4 h-4 mr-1"></i> Completada</span>' 
                            : `<button onclick="completeMission(${mission.id})" class="btn-primary px-5 py-2 rounded-lg text-sm font-bold text-white hover:opacity-90 hover:shadow-lg hover:shadow-indigo-500/40 transition-all active:scale-95">Completar</button>`
                        }
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Añadir Footer al final
            const footer = document.createElement('div');
            footer.innerHTML = FOOTER_HTML;
            container.appendChild(footer);
            
            lucide.createIcons();
            updateActiveNav(0);
        }

        function renderMentor() {
            const container = document.getElementById('appContent');
            container.innerHTML = `
                <div class="text-center mb-6 fade-in">
                    <div class="w-24 h-24 bg-gradient-to-br from-indigo-900 to-slate-900 rounded-full mx-auto flex items-center justify-center border-4 border-indigo-500/30 mb-3 shadow-[0_0_20px_rgba(99,102,241,0.3)] relative">
                        <div class="absolute inset-0 rounded-full animate-pulse bg-indigo-500/10"></div>
                        <i data-lucide="sparkles" class="w-10 h-10 text-indigo-300 relative z-10"></i>
                    </div>
                    <h2 class="font-game text-xl text-white">Mentor Lógico</h2>
                    <p class="text-xs text-slate-400 uppercase tracking-widest mt-1">Sabiduría de Maite Moyá</p>
                </div>

                <div id="chatBox" class="bg-slate-800/80 backdrop-blur rounded-xl p-4 h-[350px] overflow-y-auto mb-4 border border-slate-700 shadow-inner flex flex-col gap-3">
                    <div class="self-start max-w-[85%]"><span class="bg-indigo-900/80 text-indigo-100 text-sm px-4 py-2 rounded-2xl rounded-tl-sm inline-block border border-indigo-500/30 shadow-sm">¡Hola, líder! Soy tu guía en este viaje. ¿Cómo te sientes hoy?</span></div>
                </div>

                <div class="grid grid-cols-2 gap-3 fade-in">
                    <button onclick="addChat('fear')" class="btn-secondary p-3 rounded-lg text-xs font-bold text-slate-300 hover:bg-slate-700 hover:text-white transition-colors border border-slate-700">Tengo Miedo / Dudas</button>
                    <button onclick="addChat('fail')" class="btn-secondary p-3 rounded-lg text-xs font-bold text-slate-300 hover:bg-slate-700 hover:text-white transition-colors border border-slate-700">Fallé una misión</button>
                    <button onclick="addChat('tips')" class="btn-secondary col-span-2 p-3 rounded-lg text-xs font-bold text-indigo-300 hover:bg-indigo-900/30 hover:text-white transition-colors border border-indigo-500/30">Dame un consejo de liderazgo</button>
                </div>
                
                ${FOOTER_HTML}
            `;
            lucide.createIcons();
            updateActiveNav(1);
        }

        function addChat(type) {
            const chatBox = document.getElementById('chatBox');
            
            let userText = "";
            if(type === 'fear') userText = "Siento miedo o dudas...";
            if(type === 'fail') userText = "He fallado...";
            if(type === 'tips') userText = "Necesito un consejo...";

            const userMsgHTML = `<div class="self-end max-w-[85%] slide-up"><span class="bg-slate-600 text-white text-sm px-4 py-2 rounded-2xl rounded-tr-sm inline-block shadow-sm">${userText}</span></div>`;
            chatBox.insertAdjacentHTML('beforeend', userMsgHTML);
            chatBox.scrollTop = chatBox.scrollHeight;

            const quotes = GAME_DATA.mentorQuotes[type];
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];

            setTimeout(() => {
                const typingId = 'typing-' + Date.now();
                const typingHTML = `<div id="${typingId}" class="self-start max-w-[85%] fade-in"><span class="bg-indigo-900/50 text-indigo-200 text-xs px-3 py-2 rounded-2xl rounded-tl-sm inline-block flex gap-1"><span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce"></span><span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></span><span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span></span></div>`;
                chatBox.insertAdjacentHTML('beforeend', typingHTML);
                chatBox.scrollTop = chatBox.scrollHeight;

                setTimeout(() => {
                    document.getElementById(typingId).remove();
                    const botMsgHTML = `<div class="self-start max-w-[90%] slide-up"><span class="bg-indigo-900/80 text-indigo-100 text-sm px-4 py-2 rounded-2xl rounded-tl-sm inline-block border border-indigo-500/30 shadow-sm">${randomQuote}</span></div>`;
                    chatBox.insertAdjacentHTML('beforeend', botMsgHTML);
                    chatBox.scrollTop = chatBox.scrollHeight;
                }, 800 + Math.random() * 500);
            }, 300);
        }

        function renderProfile() {
            const container = document.getElementById('appContent');
            const totalMissions = gameState.completedMissions.length;
            
            container.innerHTML = `
                <div class="mb-6 fade-in">
                    <h2 class="font-game text-lg mb-4 text-white">Tu Hoja de Personaje</h2>
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-6 text-center border border-slate-700 shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                        <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 mb-2 font-game drop-shadow-sm">${gameState.level}</h1>
                        <p class="text-slate-400 uppercase tracking-[0.2em] text-[10px] font-bold">Rango Actual</p>
                        <div class="mt-4 flex justify-center gap-4 text-xs text-slate-500">
                             <div class="flex flex-col"><span class="text-white font-bold text-lg">${totalMissions}</span> Misiones</div>
                             <div class="w-px bg-slate-700"></div>
                             <div class="flex flex-col"><span class="text-white font-bold text-lg">${Object.values(gameState.stats).reduce((a,b)=>a+b, 0)}</span> Atributos</div>
                        </div>
                    </div>
                </div>

                <div class="fade-in" style="animation-delay: 0.1s">
                    <h3 class="text-white font-bold mb-3 flex items-center gap-2 text-sm uppercase tracking-wide opacity-80"><i data-lucide="clock" class="w-4 h-4"></i> Historial de Hazañas</h3>
                    <div class="space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar">
                        ${gameState.completedMissions.length === 0 
                            ? '<div class="text-center p-8 border-2 border-dashed border-slate-700 rounded-xl"><p class="text-slate-500 text-sm">Tu leyenda aún no ha sido escrita.</p></div>' 
                            : gameState.completedMissions.slice().reverse().map(m => {
                                const original = GAME_DATA.missions.find(om => om.id === m.id);
                                return `<div class="bg-slate-800/50 p-3 rounded-lg flex justify-between items-center text-sm border border-slate-700/50 hover:bg-slate-800 transition">
                                            <span class="text-slate-300 font-medium truncate pr-4">${original ? original.title : 'Misión Desconocida'}</span>
                                            <span class="text-slate-500 text-[10px] bg-slate-900 px-2 py-1 rounded whitespace-nowrap">${m.date}</span>
                                        </div>`
                            }).join('')
                        }
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-slate-700/50 text-center fade-in" style="animation-delay: 0.2s">
                    <button onclick="if(confirm('¿Estás seguro de que quieres borrar todo tu progreso? Esta acción es irreversible.')){localStorage.removeItem('heroRPG_save'); location.reload();}" class="text-red-400/60 hover:text-red-400 text-xs font-bold transition-colors flex items-center justify-center gap-1 mx-auto py-2 px-4 hover:bg-red-500/10 rounded-lg">
                        <i data-lucide="trash-2" class="w-3 h-3"></i> Reiniciar Progreso
                    </button>
                </div>
                
                ${FOOTER_HTML}
            `;
            lucide.createIcons();
            updateActiveNav(2);
        }

        function updateActiveNav(index) {
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach((btn, i) => {
                const iconDiv = btn.querySelector('div');
                const textSpan = btn.querySelector('span');
                
                if(i === index) {
                    btn.classList.remove('text-slate-400');
                    btn.classList.add('text-indigo-400');
                    iconDiv.classList.add('bg-slate-800', 'shadow-inner');
                } else {
                    btn.classList.add('text-slate-400');
                    btn.classList.remove('text-indigo-400');
                    iconDiv.classList.remove('bg-slate-800', 'shadow-inner');
                }
            });
        }

        // Init
        lucide.createIcons();
        updateUI();
        renderMissions(); // Default view

    </script>
</body>
</html>
