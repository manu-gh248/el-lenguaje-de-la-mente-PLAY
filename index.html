<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hero's Awakening RPG</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Iconos -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap');
        
        body { font-family: 'Roboto', sans-serif; background-color: #0f172a; color: #e2e8f0; height: 100dvh; overflow: hidden; }
        .font-game { font-family: 'Orbitron', sans-serif; }
        
        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4); /* Slate-800 con opacidad */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .card { 
            @apply glass-panel;
            border-radius: 12px; 
            transition: all 0.2s; 
        }
        .card:active { transform: scale(0.98); background: rgba(30, 41, 59, 0.6); }
        
        .btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .btn-secondary { background: rgba(51, 65, 85, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        
        /* Animaciones */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .float-anim { animation: float 6s ease-in-out infinite; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.5); border-radius: 4px; }
        
        .stat-box { @apply glass-panel; }
        .stat-box:active { transform: scale(0.95); background-color: rgba(30, 41, 59, 0.8); }

        /* Background Pattern Styles */
        #bg-pattern {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(to bottom, #0f172a, #1e1b4b);
        }
        .bg-icon {
            position: absolute;
            opacity: 0.07;
            color: white;
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col max-w-md mx-auto shadow-2xl overflow-hidden relative">

    <!-- Dynamic Background -->
    <div id="bg-pattern"></div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-20 left-4 right-4 z-50 flex flex-col items-center pointer-events-none gap-2"></div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity opacity-0" aria-hidden="true" onclick="if(event.target === this) toggleModal(false)">
        <div id="modalContent" class="glass-panel border-slate-500/30 rounded-xl p-6 max-w-sm w-full shadow-2xl transform scale-95 transition-all max-h-[85vh] overflow-y-auto custom-scrollbar bg-slate-900/80">
            <div id="dynamicModalBody"></div>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-panel border-b border-white/5 z-10 flex-none relative m-2 rounded-xl mb-0">
        <div class="p-4 pb-2">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h1 class="font-game text-lg text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 to-purple-300 leading-tight drop-shadow-sm">HERO'S AWAKENING</h1>
                    <p class="text-xs text-slate-300/80 flex items-center gap-1 mt-1">
                        <i data-lucide="shield" class="w-3 h-3"></i> Nivel <span id="userLevel" class="text-white font-bold">1</span>
                        <span id="rankBadge" class="ml-2 px-2 py-0.5 rounded bg-white/10 text-[10px] border border-white/10">Novato</span>
                    </p>
                </div>
                
                <div class="flex items-center gap-3">
                    <button onclick="showHelp()" class="p-2 bg-white/5 rounded-full hover:bg-white/10 text-indigo-300 border border-white/5 transition-colors backdrop-blur-sm">
                        <i data-lucide="help-circle" class="w-5 h-5"></i>
                    </button>
                    <div class="text-right">
                        <div class="text-[9px] text-yellow-400 font-bold uppercase tracking-wider mb-1">XP Total</div>
                        <div class="text-lg font-game text-white leading-none drop-shadow-md" id="currentXp">0</div>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-4 gap-2 text-center text-xs">
                <div onclick="showStatInfo('Str')" class="stat-box p-2 rounded border-white/5 cursor-pointer hover:bg-white/5 transition-colors select-none">
                    <span class="block text-red-400 font-bold text-sm drop-shadow-sm" id="statStr">0</span>Fuerza
                </div>
                <div onclick="showStatInfo('Agi')" class="stat-box p-2 rounded border-white/5 cursor-pointer hover:bg-white/5 transition-colors select-none">
                    <span class="block text-green-400 font-bold text-sm drop-shadow-sm" id="statAgi">0</span>Agilidad
                </div>
                <div onclick="showStatInfo('Int')" class="stat-box p-2 rounded border-white/5 cursor-pointer hover:bg-white/5 transition-colors select-none">
                    <span class="block text-blue-400 font-bold text-sm drop-shadow-sm" id="statInt">0</span>Intel.
                </div>
                <div onclick="showStatInfo('Cha')" class="stat-box p-2 rounded border-white/5 cursor-pointer hover:bg-white/5 transition-colors select-none">
                    <span class="block text-purple-400 font-bold text-sm drop-shadow-sm" id="statCha">0</span>Carisma
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 space-y-6 scroll-smooth pb-32 relative z-0" id="appContent">
        <!-- Content injected via JS -->
    </main>

    <!-- Navigation -->
    <nav class="glass-panel border-t border-white/5 absolute bottom-0 w-full z-20 m-0 rounded-t-xl backdrop-blur-xl">
        <div class="flex justify-around p-2 pb-6 pt-3">
            <button onclick="renderMissions()" class="nav-btn flex flex-col items-center text-indigo-300 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-white/5 transition"><i data-lucide="sword" class="w-6 h-6 drop-shadow-sm"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Misiones</span>
            </button>
            <button onclick="renderMentor()" class="nav-btn flex flex-col items-center text-slate-400 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-white/5 transition"><i data-lucide="bot" class="w-6 h-6 drop-shadow-sm"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Mentor</span>
            </button>
            <button onclick="renderProfile()" class="nav-btn flex flex-col items-center text-slate-400 p-2 rounded-lg transition-all active:scale-95 group">
                <div class="p-1 rounded group-hover:bg-white/5 transition"><i data-lucide="user" class="w-6 h-6 drop-shadow-sm"></i></div>
                <span class="text-[10px] font-bold mt-1 uppercase tracking-wide">Perfil</span>
            </button>
        </div>
    </nav>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. CONFIGURATION & DATA ---
        const APP_VERSION = "2.3.1"; 
        
        // --- GENERADOR DE FONDO DE ICONOS ---
        function generateBackground() {
            const bgContainer = document.getElementById('bg-pattern');
            const icons = ['sword', 'shield', 'heart', 'message-circle', 'zap', 'crown', 'book-open', 'star'];
            const count = 30; // Cantidad de iconos flotantes

            for (let i = 0; i < count; i++) {
                const iconName = icons[Math.floor(Math.random() * icons.length)];
                const el = document.createElement('div');
                el.className = 'bg-icon float-anim';
                
                // Random position
                el.style.left = Math.random() * 100 + '%';
                el.style.top = Math.random() * 100 + '%';
                
                // Random size (8bit feel: smallish)
                const size = Math.floor(Math.random() * 20) + 15; // 15px to 35px
                el.style.width = size + 'px';
                el.style.height = size + 'px';
                
                // Random animation delay
                el.style.animationDelay = (Math.random() * 5) + 's';
                el.style.animationDuration = (Math.random() * 5 + 5) + 's'; // 5-10s duration

                // Create SVG icon using lucide logic via innerHTML injection is hard without the lib fully parsing.
                // We will add the icon class and let lucide.createIcons() handle it at the end.
                el.innerHTML = `<i data-lucide="${iconName}" style="width:100%; height:100%"></i>`;
                
                bgContainer.appendChild(el);
            }
        }

        // --- FOOTER HTML ---
        const FOOTER_HTML = `
            <div class="text-center pt-10 pb-24 opacity-60 hover:opacity-100 transition-opacity duration-500 cursor-default select-none">
                <p class="text-[10px] text-indigo-200 font-medium flex items-center justify-center gap-1 mb-1">
                    Hecho con mucho <i data-lucide="heart" class="w-3 h-3 text-red-400 fill-red-400 animate-pulse"></i> por el equipo de Liderapia para ti
                </p>
                <p class="text-[9px] text-slate-500 font-game tracking-widest">v${APP_VERSION}</p>
            </div>
        `;

        const STAT_DEFINITIONS = {
            Str: { name: "El Pilar Interior", book_concept: "Autoestima y Límites", desc: "Imagina tu autoestima como tu columna vertebral. Esta fuerza no golpea; sostiene. Es la valentía serena de decir 'No' cuando algo atenta contra tus valores. Es protegerte de los 'vampiros de energía' sin volverte agresivo.", icon: "shield-alert", color: "text-red-400" },
            Agi: { name: "El Baile Social", book_concept: "Adaptabilidad y Escucha", desc: "La vida es un baile impredecible. La Agilidad no es rapidez, es ritmo. Es la capacidad de escuchar el doble de lo que hablas. Es entender que el mapa no es el territorio: cada persona ve el mundo distinto.", icon: "wind", color: "text-green-400" },
            Int: { name: "El Observador", book_concept: "Gestión Emocional", desc: "Tienes un narrador en tu cabeza que a veces miente. Esta estadística es tu 'Observador Consciente'. Es la habilidad de pillar a ese saboteador interno y reescribir el guion. Es entender que el miedo no es un stop, sino una señal.", icon: "brain-circuit", color: "text-blue-400" },
            Cha: { name: "Luz Propia", book_concept: "Liderazgo y Conexión", desc: "El verdadero carisma no es deslumbrar, sino hacer que los demás se sientan importantes. No es una máscara, es autenticidad radical. Liderar no es mandar, es servir e inspirar.", icon: "sparkles", color: "text-purple-400" }
        };

        const generateMissions = () => {
            const missions = [
                // FASE 1: AUTOCONCIENCIA
                { id: 1, title: "El Espejo", desc: "Mírate al espejo y di 3 fortalezas en voz alta.", stat: "Int", xp: 50, type: "daily", ref: "Cap. 2",
                  story: "Tu reflejo suele ser el primero en recibir tus críticas. Hoy cambiaremos el guion. Mírate a los ojos, no a tus defectos, y reconoce quién eres realmente.",
                  book_context: "La autoconciencia es el cimiento del líder. Si no reconoces tu propio valor, nadie más lo hará por ti." },

                { id: 2, title: "Valores Nucleares", desc: "Escribe tus 5 valores principales.", stat: "Int", xp: 100, type: "mental", ref: "Cap. 2",
                  story: "Un héroe sin brújula está perdido en la tormenta. Tus valores son esa brújula. ¿Qué es innegociable para ti? Defínelo para no perderte.",
                  book_context: "El liderazgo auténtico nace de la coherencia entre lo que piensas, lo que sientes y lo que haces." },

                { id: 3, title: "Inventario de Miedos", desc: "Ponle nombre a tu miedo de hoy.", stat: "Int", xp: 80, type: "mental", ref: "Cap. 1",
                  story: "El miedo es una sombra: solo asusta cuando no la miras de frente. Al ponerle nombre ('tengo miedo a fallar'), le quitas su poder de monstruo.",
                  book_context: "Identificar el miedo es el primer paso para transformarlo en un aliado que te indica dónde debes crecer." },

                { id: 4, title: "Zona de Confort", desc: "Haz algo pequeño que te de pereza.", stat: "Str", xp: 120, type: "combat", ref: "Cap. 1",
                  story: "La comodidad es un sofá muy agradable, pero nada crece allí. Hoy, da un pequeño paso fuera. Ese cosquilleo en el estómago es la señal de que estás vivo.",
                  book_context: "El héroe nace justo donde termina tu zona de confort. No necesitas grandes gestos, solo movimiento constante." },

                { id: 5, title: "Postura de Poder", desc: "Mantén una postura erguida 10 min.", stat: "Cha", xp: 60, type: "daily", ref: "Cap. 2",
                  story: "Tu cuerpo le habla a tu mente. Si te encoges, te sientes pequeño. Si te yergues, tu cerebro recibe la señal de 'estoy listo'. Ocupa tu espacio.",
                  book_context: "La comunicación no verbal empieza contigo mismo. Tu fisiología determina tu psicología." },

                { id: 6, title: "Sin Quejas", desc: "3 horas sin quejarte de nada.", stat: "Int", xp: 100, type: "stealth", ref: "Cap. 6",
                  story: "La queja es como una silla mecedora: te mantiene en movimiento pero no te lleva a ningún lado. Hoy, bájate de la silla y actúa o acepta.",
                  book_context: "Los 'vampiros de energía' se alimentan de la queja. Cortar ese ciclo es vital para mantener tu liderazgo." },

                { id: 7, title: "La Gratitud", desc: "Agradece algo genuinamente a alguien.", stat: "Cha", xp: 70, type: "social", ref: "Cap. 3",
                  story: "Damos por hecho lo extraordinario. Hoy detente, observa a alguien que te ayude y dile 'gracias' mirándole a los ojos. Es magia pura.",
                  book_context: "La gratitud conecta personas y desarma barreras. Es la habilidad social más rentable y menos utilizada." },

                { id: 8, title: "El Observador", desc: "Describe tu entorno solo con hechos.", stat: "Agi", xp: 90, type: "mental", ref: "Cap. 3",
                  story: "Tu mente es una máquina de juzgar: 'esto es feo', 'aquello es aburrido'. Apaga el juez. Sé una cámara de vídeo. Solo registra hechos.",
                  book_context: "Separar los hechos de las interpretaciones es clave para la Inteligencia Social y evita conflictos innecesarios." },

                { id: 9, title: "Detectar Juicios", desc: "Píllate juzgando y detente.", stat: "Int", xp: 110, type: "stealth", ref: "Cap. 6",
                  story: "El juicio es un muro que construyes entre tú y los demás. Hoy, cuando pienses mal de alguien, detente y di: 'Es solo mi mapa, no su territorio'.",
                  book_context: "Para liderar personas diferentes a ti, debes suspender el juicio y activar la curiosidad." },

                { id: 10, title: "Tu Propósito", desc: "Define tu objetivo del mes en una frase.", stat: "Str", xp: 100, type: "mental", ref: "Cap. 7",
                  story: "Quien no sabe a dónde va, acaba en cualquier parte. Enfoca tu láser mental. Una sola frase, un solo norte. Eso te da poder.",
                  book_context: "La claridad precede al éxito. El líder define el destino antes de empezar a caminar." },

                // FASE 2: HABILIDADES SOCIALES
                { id: 11, title: "Escucha Radical", desc: "5 min escuchando sin interrumpir.", stat: "Agi", xp: 150, type: "social", ref: "Cap. 3",
                  story: "Normalmente escuchamos esperando el turno para hablar. Hoy no. Hoy escucha para entender. Calla tu diálogo interno y regala tu presencia.",
                  book_context: "Escuchar es la habilidad más difícil y valiosa. No se trata de oír palabras, sino de captar emociones." },

                { id: 12, title: "El Saludo", desc: "Saluda sonriendo a 3 desconocidos.", stat: "Cha", xp: 120, type: "social", ref: "Cap. 4",
                  story: "Un 'buenos días' genuino puede cambiar el día de alguien. Sé tú quien inicie la chispa de humanidad en un mundo de pantallas.",
                  book_context: "El líder da el primer paso en la conexión social. Romper el hielo demuestra seguridad y calidez." },

                { id: 13, title: "Contacto Visual", desc: "Mira a los ojos al hablar.", stat: "Cha", xp: 80, type: "social", ref: "Cap. 4",
                  story: "Los ojos son el puente. Si miras al suelo, te escondes. Si miras al móvil, te desconectas. Mira al otro y dile sin palabras: 'Te veo'.",
                  book_context: "El contacto visual genera oxitocina y confianza. Es la base biológica de la conexión humana." },

                { id: 14, title: "Preguntar Primero", desc: "Haz 3 preguntas antes de opinar.", stat: "Agi", xp: 130, type: "social", ref: "Cap. 3",
                  story: "Tu opinión puede esperar. La historia del otro es un tesoro por descubrir. Pregunta con curiosidad de niño y verás cómo se abren las puertas.",
                  book_context: "Interesarse por los demás es el secreto para ser interesante. Cambia el 'yo digo' por el 'cuéntame más'." },

                { id: 15, title: "Recordar Nombres", desc: "Usa el nombre de tu interlocutor.", stat: "Cha", xp: 90, type: "social", ref: "Cap. 3",
                  story: "El sonido más dulce para una persona es su propio nombre. Úsalo con respeto y verás cómo la distancia entre vosotros desaparece.",
                  book_context: "Personalizar la comunicación demuestra que el otro te importa, no como recurso, sino como ser humano." },

                { id: 16, title: "Lenguaje Positivo", desc: "Sustituye 'pero' por 'y'.", stat: "Int", xp: 140, type: "mental", ref: "Cap. 5",
                  story: "El 'pero' borra todo lo anterior ('Te quiero, pero...'). El 'y' suma ('Te quiero y me gustaría...'). Hoy sé un arquitecto que construye puentes, no muros.",
                  book_context: "Las palabras crean realidades. Un lenguaje inclusivo y positivo transforma conflictos en colaboraciones." },

                { id: 17, title: "Validar Emociones", desc: "Di 'Entiendo cómo te sientes'.", stat: "Agi", xp: 110, type: "social", ref: "Cap. 4",
                  story: "No trates de arreglarlo todo. A veces, la gente solo necesita sentirse comprendida. Validar su emoción es como darles un abrazo verbal.",
                  book_context: "La empatía no es estar de acuerdo, es comprender la emoción ajena. Es el pegamento de cualquier equipo." },

                { id: 18, title: "El Silencio", desc: "Pausa 3 segundos antes de responder.", stat: "Str", xp: 100, type: "mental", ref: "Cap. 5",
                  story: "En la pausa vive tu libertad. Reaccionar es instintivo; responder es humano. Tómate 3 segundos para elegir ser tu mejor versión.",
                  book_context: "El silencio es una herramienta de poder. Demuestra reflexión y control sobre la impulsividad." },

                { id: 19, title: "Tono de Voz", desc: "Analiza tu tono en un audio.", stat: "Cha", xp: 80, type: "daily", ref: "Cap. 4",
                  story: "No es lo que dices, es cómo lo dices. Tu voz tiene música. ¿Es una marcha militar o una melodía acogedora? Escúchate desde fuera.",
                  book_context: "El paralenguaje (tono, volumen) transmite más información emocional que las propias palabras." },

                { id: 20, title: "Feedback", desc: "Pide una cosa a mejorar a alguien.", stat: "Str", xp: 160, type: "combat", ref: "Cap. 3",
                  story: "El ego quiere oír halagos. El héroe quiere la verdad. Preguntar '¿en qué puedo mejorar?' requiere valentía, pero acelera tu crecimiento x10.",
                  book_context: "La retroalimentación es el desayuno de los campeones. Sin espejos externos, no vemos nuestras 'manchas'." },

                // FASE 3: BARRERAS
                { id: 21, title: "Decir NO", desc: "Rechaza una petición amablemente.", stat: "Str", xp: 200, type: "combat", ref: "Cap. 6",
                  story: "Cada vez que dices 'Sí' por compromiso, te estás diciendo 'No' a ti mismo. Hoy, pon un límite con amor. Tu tiempo es sagrado.",
                  book_context: "La asertividad es la capacidad de respetar tus derechos sin pisotear los de los demás." },

                { id: 22, title: "Reconocer Error", desc: "Admite un fallo sin excusas.", stat: "Str", xp: 180, type: "combat", ref: "Cap. 6",
                  story: "Las excusas son para las víctimas. Los líderes dicen 'Me equivoqué, lo arreglo'. Esa vulnerabilidad te hace increíblemente fuerte y confiable.",
                  book_context: "La responsabilidad radical elimina el drama y enfoca la energía en la solución." },

                { id: 23, title: "Evitar Rumores", desc: "No participes en chismes.", stat: "Str", xp: 150, type: "stealth", ref: "Cap. 5",
                  story: "Hablar de otros es fácil. Hablar de ideas es grande. Hoy, cuando empiece el chisme, sé el guardián de la dignidad y cambia el tema.",
                  book_context: "La impecabilidad en tus palabras genera un entorno de confianza y seguridad psicológica." },

                { id: 24, title: "Pedir Ayuda", desc: "Solicita ayuda en algo.", stat: "Agi", xp: 120, type: "social", ref: "Cap. 2",
                  story: "El mito del héroe solitario es falso. Superman tiene a la Liga de la Justicia. Pedir ayuda no es debilidad, es inteligencia colaborativa.",
                  book_context: "Reconocer tus límites permite que otros brillen con sus fortalezas. Eso es delegar y empoderar." },

                { id: 25, title: "Hablar en Público", desc: "Da tu opinión en un grupo.", stat: "Cha", xp: 170, type: "combat", ref: "Cap. 6",
                  story: "Tu voz importa. Ese miedo en la garganta es solo energía acumulada. Suéltala. Al compartir tu idea, enriqueces al mundo.",
                  book_context: "Vencer el miedo escénico es crucial. Si no comunicas tu valor, el mundo se lo pierde." },

                { id: 26, title: "No Supongas", desc: "Pregunta '¿A qué te refieres?'.", stat: "Int", xp: 130, type: "mental", ref: "Cap. 6",
                  story: "El 90% de los conflictos son películas que nos montamos. Deja de ser guionista de dramas y conviértete en periodista: pregunta y verifica.",
                  book_context: "Las suposiciones son termitas para las relaciones. La claridad es el antídoto." },

                { id: 27, title: "Cortar al Vampiro", desc: "Cierra charla con alguien que se queja.", stat: "Str", xp: 190, type: "combat", ref: "Cap. 6",
                  story: "Tu energía es limitada. No dejes que nadie la use de basurero emocional. Con elegancia, di 'Hablemos de soluciones' o retírate.",
                  book_context: "Proteger tu entorno emocional es responsabilidad tuya. Rodéate de personas que sumen." },

                { id: 28, title: "La Sonrisa", desc: "Sonríe al hablar por teléfono.", stat: "Cha", xp: 60, type: "daily", ref: "Cap. 4",
                  story: "La sonrisa se escucha. Cambia la química de tu cerebro y relaja al interlocutor, aunque no te vea. Es tu tarjeta de visita auditiva.",
                  book_context: "Las neuronas espejo funcionan incluso a distancia. Tu estado emocional es contagioso." },

                { id: 29, title: "Vestimenta", desc: "Vístete hoy un poco mejor.", stat: "Cha", xp: 70, type: "daily", ref: "Cap. 4",
                  story: "No es vanidad, es respeto hacia ti y hacia la ocasión. Cuando te ves bien, te sientes capaz. Vístete para el héroe que quieres ser.",
                  book_context: "Tu imagen es comunicación. Asegúrate de que lo que ven coincida con tu valía interior." },

                { id: 30, title: "Puntualidad", desc: "Llega 5 min antes.", stat: "Str", xp: 80, type: "daily", ref: "Cap. 7",
                  story: "El tiempo es el recurso más valioso. Llegar a tiempo es decir 'Te respeto'. Llegar tarde es robar vida. Hoy, regala respeto.",
                  book_context: "La gestión del tiempo es gestión de vida. La puntualidad habla de tu fiabilidad y compromiso." },

                // FASE 4: LIDERAZGO
                { id: 31, title: "Delegar", desc: "Asigna una tarea confiando.", stat: "Agi", xp: 140, type: "social", ref: "Cap. 8",
                  story: "Querer hacerlo todo tú es el techo de tu crecimiento. Suelta el control. Confiar en otro es el mayor regalo que le puedes hacer.",
                  book_context: "El líder no crea seguidores, crea más líderes. Delegar es la herramienta para ello." },

                { id: 32, title: "Motivar", desc: "Reconoce un buen trabajo.", stat: "Cha", xp: 130, type: "social", ref: "Cap. 8",
                  story: "La gente olvida lo que dices, pero no cómo les haces sentir. Hoy sé un cazador de talentos: busca algo bueno que alguien hizo y dilo.",
                  book_context: "El reconocimiento es combustible emocional. Aumenta el rendimiento y la lealtad." },

                { id: 33, title: "Priorizar", desc: "Haz lo importante, no lo urgente.", stat: "Str", xp: 110, type: "mental", ref: "Cap. 7",
                  story: "Estar ocupado no es ser productivo. Para un momento la rueda del hámster. Elige UNA cosa que realmente mueva la aguja y hazla.",
                  book_context: "La matriz de Eisenhower: diferenciar urgente de importante es vital para la eficacia." },

                { id: 34, title: "Decisión Rápida", desc: "Decide algo trivial en 10 seg.", stat: "Agi", xp: 90, type: "mental", ref: "Cap. 8",
                  story: "La duda paraliza. Entrena tu músculo de decisión con cosas pequeñas (qué comer, qué ver). Acción imperfecta mejor que inacción perfecta.",
                  book_context: "La parálisis por análisis mata oportunidades. El líder toma decisiones y asume consecuencias." },

                { id: 35, title: "Adaptabilidad", desc: "Ante un fallo, busca solución.", stat: "Agi", xp: 150, type: "combat", ref: "Cap. 8",
                  story: "El plan A falló. ¿Y qué? El abecedario tiene 26 letras más. No te estanques en el 'por qué pasó', salta al 'cómo lo arreglamos'.",
                  book_context: "La resiliencia y la flexibilidad son las competencias clave en un entorno cambiante." },

                { id: 36, title: "Inspirar", desc: "Comparte una idea útil.", stat: "Cha", xp: 100, type: "social", ref: "Cap. 8",
                  story: "El conocimiento guardado se pudre; compartido se multiplica. Sé un río, no un embalse. Comparte algo que te inspiró hoy.",
                  book_context: "Liderar es servir. Tu conocimiento debe estar al servicio del desarrollo de los otros." },

                { id: 37, title: "Autocuidado", desc: "20 min para ti.", stat: "Str", xp: 100, type: "daily", ref: "Cap. 7",
                  story: "No puedes servir agua de un vaso vacío. Cuidarte no es egoísta, es estratégico. Recarga tu batería para poder iluminar a otros.",
                  book_context: "El bienestar del líder es prerrequisito para el bienestar del equipo." },

                { id: 38, title: "Networking", desc: "Saluda a un antiguo contacto.", stat: "Cha", xp: 140, type: "social", ref: "Cap. 3",
                  story: "Las oportunidades vienen de las personas. Planta semillas antes de tener hambre. Un simple '¿Cómo estás?' reactiva puentes.",
                  book_context: "Somos seres sociales. Tu red de contactos es tu red de seguridad y crecimiento." },

                { id: 39, title: "Resolver Conflicto", desc: "Aborda un tema pendiente.", stat: "Str", xp: 200, type: "combat", ref: "Cap. 6",
                  story: "Esa conversación difícil es como una herida sin limpiar. Duele, pero hay que curarla. Habla desde el corazón y busca la paz.",
                  book_context: "El conflicto no gestionado se enquista. Abordarlo con asertividad y empatía es sanador." },

                { id: 40, title: "La Pausa", desc: "Para 5 min a respirar.", stat: "Int", xp: 70, type: "daily", ref: "Cap. 7",
                  story: "En la vorágine, parar es un acto revolucionario. Desconecta el piloto automático. Vuelve a tu cuerpo. Respira. Ahora sigue.",
                  book_context: "El mindfulness o atención plena reduce el estrés y mejora la toma de decisiones." },

                // FASE 5: MAESTRÍA
                { id: 41, title: "Mentoría", desc: "Enseña algo a alguien.", stat: "Cha", xp: 160, type: "social", ref: "Cap. 8",
                  story: "Hoy tú eres el maestro. Pasa la antorcha. Al enseñar, aprendes dos veces y dejas un legado en la otra persona.",
                  book_context: "El ciclo del héroe se completa cuando compartes el elixir del conocimiento con tu comunidad." },

                { id: 42, title: "Cero Excusas", desc: "Un día sin excusas.", stat: "Str", xp: 180, type: "combat", ref: "Cap. 6",
                  story: "Es fácil culpar al tráfico, al jefe o al tiempo. Hoy sé dueño radical de tus circunstancias. Si algo no sale, asúmelo y avanza.",
                  book_context: "La víctima culpa; el líder se responsabiliza. Ese cambio de mentalidad lo es todo." },

                { id: 43, title: "Empatía Profunda", desc: "Pregunta: '¿Qué necesitas?'.", stat: "Agi", xp: 170, type: "social", ref: "Cap. 2",
                  story: "A veces amamos mal, dando lo que queremos dar y no lo que el otro necesita. Hoy haz la pregunta mágica y escucha la respuesta.",
                  book_context: "La empatía cognitiva y emocional nos permite conectar con la realidad del otro, no con nuestra proyección." },

                { id: 44, title: "Visión", desc: "Visualiza tu éxito 5 min.", stat: "Int", xp: 90, type: "mental", ref: "Cap. 7",
                  story: "Tu cerebro no distingue entre realidad e imaginación vívida. Crea el recuerdo del futuro. Si puedes verlo, puedes construirlo.",
                  book_context: "La visualización prepara neuronalmente al cerebro para ejecutar las competencias necesarias." },

                { id: 45, title: "Asertividad II", desc: "Expresa una necesidad tuya.", stat: "Str", xp: 150, type: "combat", ref: "Cap. 5",
                  story: "Nadie lee mentes. Si necesitas apoyo, espacio o cariño, pídelo claramente. Ser fuerte también es mostrar tu necesidad.",
                  book_context: "La comunicación clara de necesidades previene resentimientos y malos entendidos." },

                { id: 46, title: "Lectura Corporal", desc: "Adivina una emoción.", stat: "Agi", xp: 100, type: "stealth", ref: "Cap. 4",
                  story: "Fíjate en los hombros, en el ceño, en las manos. El cuerpo grita lo que la boca calla. Sé un detective de emociones.",
                  book_context: "Más del 60% de la comunicación es no verbal. Aprender a leerla te da una ventaja enorme." },

                { id: 47, title: "El Elogio", desc: "Elogia a espaldas de alguien.", stat: "Cha", xp: 130, type: "social", ref: "Cap. 3",
                  story: "Hablar bien de alguien cuando no está es la forma más pura de lealtad. Esas palabras siempre llegan a su destino y brillan más.",
                  book_context: "Construir una reputación de integridad y positividad atrae a las mejores personas a tu lado." },

                { id: 48, title: "Desconexión", desc: "1 hora sin móvil.", stat: "Int", xp: 110, type: "daily", ref: "Cap. 7",
                  story: "Rompe las cadenas digitales. Mira el cielo, no la pantalla. Recupera tu atención, que es tu activo más valioso.",
                  book_context: "La hiperconexión erosiona la capacidad de reflexión profunda y presencia, claves del liderazgo." },

                { id: 49, title: "Ruptura de Patrón", desc: "Haz algo diferente hoy.", stat: "Agi", xp: 120, type: "mental", ref: "Cap. 8",
                  story: "Si buscas resultados distintos, no hagas lo mismo. Lávate los dientes con la otra mano, cambia la ruta. Despierta a tu cerebro.",
                  book_context: "La flexibilidad neuronal se entrena con la novedad. Un líder ágil abraza el cambio." },

                { id: 50, title: "El Salto", desc: "Haz esa llamada pendiente.", stat: "Str", xp: 200, type: "combat", ref: "Cap. 6",
                  story: "Esa tarea que evitas es la puerta a tu siguiente nivel. Respira hondo, cuenta 3, 2, 1... y salta. Al otro lado está tu héroe.",
                  book_context: "La acción masiva cura el miedo. El final de este viaje es solo el principio de tu nueva vida." }
            ];
            
            return missions.map(m => {
                if(m.stat === 'Str') { m.color = "border-red-500/50"; m.text_color = "text-red-300"; m.bg_btn = "bg-red-500/10 hover:bg-red-500/20 text-red-300"; }
                if(m.stat === 'Agi') { m.color = "border-green-500/50"; m.text_color = "text-green-300"; m.bg_btn = "bg-green-500/10 hover:bg-green-500/20 text-green-300"; }
                if(m.stat === 'Int') { m.color = "border-blue-500/50"; m.text_color = "text-blue-300"; m.bg_btn = "bg-blue-500/10 hover:bg-blue-500/20 text-blue-300"; }
                if(m.stat === 'Cha') { m.color = "border-purple-500/50"; m.text_color = "text-purple-300"; m.bg_btn = "bg-purple-500/10 hover:bg-purple-500/20 text-purple-300"; }
                return m;
            });
        };

        const ALL_MISSIONS = generateMissions();
        const TOTAL_MAX_XP = ALL_MISSIONS.reduce((sum, m) => sum + m.xp, 0);

        // --- 2. STATE MANAGEMENT ---
        let gameState = {
            version: APP_VERSION,
            xp: 0,
            level: 1,
            stats: { Str: 0, Agi: 0, Int: 0, Cha: 0 },
            pendingIds: [], 
            activeIds: [],
            completedIds: [], 
            skippedIds: []
        };

        function initGame() {
            generateBackground(); // INIT BACKGROUND
            const saved = localStorage.getItem('heroRPG_v2_save');
            if (saved) {
                const parsed = JSON.parse(saved);
                if(parsed.version === APP_VERSION) {
                    gameState = parsed;
                } else {
                    setupNewGame();
                }
            } else {
                setupNewGame();
            }
            updateUI();
            renderView();
        }

        function setupNewGame() {
            const allIds = ALL_MISSIONS.map(m => m.id);
            gameState.activeIds = allIds.slice(0, 5);
            gameState.pendingIds = allIds.slice(5);
            gameState.xp = 0;
            gameState.level = 1;
            gameState.stats = { Str: 1, Agi: 1, Int: 1, Cha: 1 };
            gameState.completedIds = [];
            gameState.skippedIds = [];
            saveGame();
        }

        function saveGame() {
            localStorage.setItem('heroRPG_v2_save', JSON.stringify(gameState));
            updateUI();
        }

        // --- 3. MISSION LOGIC & MODALS ---

        function getMissionById(id) {
            return ALL_MISSIONS.find(m => m.id === id);
        }

        function showMissionDetails(id) {
            const m = getMissionById(id);
            const html = `
                <div class="text-left">
                    <div class="flex items-center gap-3 mb-4 border-b border-white/10 pb-3">
                        <div class="p-2 rounded-lg bg-white/5 ${m.text_color}">
                            <i data-lucide="book-open" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <span class="text-[10px] uppercase font-bold tracking-widest text-slate-400">${m.ref}</span>
                            <h3 class="text-xl font-bold text-white leading-tight">${m.title}</h3>
                        </div>
                    </div>
                    
                    <div class="mb-6 space-y-4">
                        <div class="bg-white/5 p-4 rounded-lg border-l-2 ${m.color.replace('border', 'border-l')}">
                            <h4 class="text-xs uppercase text-slate-500 font-bold mb-1">La Historia</h4>
                            <p class="text-slate-200 text-sm leading-relaxed italic">"${m.story}"</p>
                        </div>

                        <div>
                            <h4 class="text-xs uppercase text-indigo-300 font-bold mb-1 flex items-center gap-1">
                                <i data-lucide="graduation-cap" class="w-3 h-3"></i> Sabiduría del Libro
                            </h4>
                            <p class="text-slate-400 text-sm leading-relaxed">${m.book_context}</p>
                        </div>
                    </div>

                    <button onclick="toggleModal(false)" class="w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded font-bold transition-colors border border-white/5">Volver a la Aventura</button>
                </div>
            `;
            toggleModal(true, html);
            lucide.createIcons();
        }

        function completeMission(id) {
            const mission = getMissionById(id);
            if (!mission) return;
            showConfirmation("¿Misión Cumplida?", `"${mission.title}": Confirma honestamente que la has realizado.`, () => {
                gameState.xp += mission.xp;
                if (gameState.stats[mission.stat]) gameState.stats[mission.stat]++;
                gameState.activeIds = gameState.activeIds.filter(mid => mid !== id);
                gameState.completedIds.push({ id: id, date: new Date().toLocaleDateString() });
                replenishActiveMissions();
                showToast(`¡Bien hecho! +${mission.xp} XP`, 'success');
                saveGame();
                checkGraduation();
                renderView();
            });
        }

        function skipMission(id) {
            showConfirmation("¿Saltar Misión?", "Irá a 'Saltadas'. Podrás recuperarla en tu Perfil.", () => {
                gameState.activeIds = gameState.activeIds.filter(mid => mid !== id);
                gameState.skippedIds.push(id);
                replenishActiveMissions();
                showToast("Misión pospuesta", "neutral");
                saveGame();
                checkGraduation();
                renderView();
            });
        }

        function replenishActiveMissions() {
            if (gameState.activeIds.length < 5 && gameState.pendingIds.length > 0) {
                gameState.activeIds.push(gameState.pendingIds.shift());
            }
        }

        function recoverSkipped(id) {
            gameState.skippedIds = gameState.skippedIds.filter(sid => sid !== id);
            gameState.pendingIds.unshift(id);
            replenishActiveMissions();
            showToast("Misión recuperada", "success");
            saveGame();
            renderView();
        }

        // --- 4. GRADUATION & UI ---
        function checkGraduation() {
            if (gameState.pendingIds.length === 0 && gameState.activeIds.length === 0) {
                setTimeout(showGraduationModal, 1000);
            }
        }

        function showGraduationModal() {
            const scorePercent = (gameState.xp / TOTAL_MAX_XP) * 100;
            let title = "", badge = "", msg = "", color = "", grad = false;

            if (scorePercent < 80) {
                title = "INTENTO INCOMPLETO"; badge = "Aspirante"; color = "text-slate-400";
                msg = "Tu puntuación es baja (<80%). Un verdadero héroe no se rinde. Recupera las misiones saltadas.";
                grad = false;
            } else if (scorePercent < 90) {
                title = "HÉROE CONSCIENTE"; badge = "Bronce"; color = "text-amber-500";
                msg = "Has despertado. Sigue practicando para elevar tu influencia.";
                grad = true;
            } else if (scorePercent < 96) {
                title = "LÍDER AUTÉNTICO"; badge = "Plata"; color = "text-slate-200";
                msg = "Tu compromiso es notable. Lideras con el ejemplo.";
                grad = true;
            } else {
                title = "AGENTE DEL CAMBIO"; badge = "Oro"; color = "text-yellow-400";
                msg = "¡Extraordinario! Has alcanzado la maestría. 'Tú ya eres parte de ese cambio'.";
                grad = true;
            }

            if (grad) launchConfetti();

            const html = `
                <div class="text-center">
                    <div class="w-24 h-24 rounded-full bg-white/5 mx-auto flex items-center justify-center mb-4 border-4 border-white/10 relative overflow-hidden backdrop-blur-md">
                        <i data-lucide="award" class="w-12 h-12 ${color} relative z-10"></i>
                    </div>
                    <h2 class="text-2xl font-bold font-game mb-1 ${color}">${title}</h2>
                    <p class="text-xs uppercase font-bold text-slate-400 mb-4">Puntuación: ${Math.floor(scorePercent)}%</p>
                    <div class="bg-white/5 p-4 rounded-lg mb-6 border border-white/10 text-sm text-slate-300">"${msg}"</div>
                    ${!grad ? `<button onclick="toggleModal(false); currentView='profile'; renderView();" class="w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded font-bold border border-white/5">Recuperar Misiones</button>` : 
                    `<button onclick="if(confirm('¿Reiniciar?')){ localStorage.clear(); location.reload(); }" class="w-full py-3 btn-primary text-white rounded font-bold shadow-lg shadow-indigo-500/30">Reiniciar Viaje</button>`}
                </div>
            `;
            toggleModal(true, html);
            lucide.createIcons();
        }

        let currentView = 'missions'; 
        
        function renderView() {
            // Nav State
            document.querySelectorAll('.nav-btn').forEach((btn, idx) => {
                const active = (idx === 0 && currentView === 'missions') || (idx === 1 && currentView === 'mentor') || (idx === 2 && currentView === 'profile');
                btn.className = `nav-btn flex flex-col items-center p-2 rounded-lg transition-all active:scale-95 group ${active ? 'text-indigo-300' : 'text-slate-400'}`;
                btn.querySelector('div').className = `p-1 rounded transition ${active ? 'bg-white/10' : 'group-hover:bg-white/5'}`;
            });

            const c = document.getElementById('appContent');
            c.innerHTML = ''; 
            if (currentView === 'missions') renderMissionsView(c);
            if (currentView === 'mentor') renderMentorView(c);
            if (currentView === 'profile') renderProfileView(c);
            lucide.createIcons();
        }

        function renderMissionsView(c) {
            c.insertAdjacentHTML('beforeend', `<div class="flex justify-between mb-4 fade-in"><div><h2 class="font-game text-lg text-white">Misiones Activas</h2><span class="text-xs text-slate-300/70">Cola: <b>${gameState.pendingIds.length}</b></span></div></div>`);
            
            if (gameState.activeIds.length === 0 && gameState.pendingIds.length === 0) {
                c.insertAdjacentHTML('beforeend', `<div class="text-center p-10 border-2 border-dashed border-white/10 rounded-xl mt-10 glass-panel"><h3 class="text-white font-bold">¡Sin Misiones!</h3><button onclick="checkGraduation()" class="mt-4 px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded text-sm font-bold shadow-lg">Ver Graduación</button></div>`);
                return;
            }

            gameState.activeIds.forEach((id, idx) => {
                const m = getMissionById(id);
                const html = `
                    <div class="card p-5 mb-4 border-l-4 ${m.color} fade-in" style="animation-delay: ${idx * 50}ms">
                        <div class="flex justify-between items-start">
                            <div><span class="text-[10px] font-bold uppercase ${m.text_color} mb-1 block tracking-wider">${m.ref}</span><h3 class="font-bold text-white text-lg drop-shadow-sm">${m.title}</h3></div>
                            <div class="bg-white/10 px-2 py-1 rounded text-xs text-yellow-400 font-bold border border-white/10 ml-2 shadow-inner">+${m.xp} XP</div>
                        </div>
                        <p class="text-sm text-slate-300 mt-2 line-clamp-2">${m.desc}</p>
                        
                        <div class="mt-3 mb-4">
                            <button onclick="showMissionDetails(${m.id})" class="text-xs font-bold ${m.text_color} flex items-center hover:underline hover:opacity-80 transition-opacity">
                                <i data-lucide="info" class="w-3 h-3 mr-1"></i> Leer más sobre esto
                            </button>
                        </div>

                        <div class="flex gap-2 pt-3 border-t border-white/10">
                            <button onclick="skipMission(${m.id})" class="flex-1 py-2 rounded text-xs font-bold text-slate-400 border border-white/10 hover:bg-white/5 transition-colors">Saltar</button>
                            <button onclick="completeMission(${m.id})" class="flex-[2] btn-primary py-2 rounded text-xs font-bold text-white shadow-lg shadow-indigo-500/20 hover:opacity-90 transition-opacity">Completar</button>
                        </div>
                    </div>`;
                c.insertAdjacentHTML('beforeend', html);
            });
            c.insertAdjacentHTML('beforeend', FOOTER_HTML);
        }

        function renderProfileView(c) {
            const completed = gameState.completedIds.length, skipped = gameState.skippedIds.length, total = ALL_MISSIONS.length;
            const prog = Math.round((completed / total) * 100);
            
            c.insertAdjacentHTML('beforeend', `
                <div class="fade-in">
                    <h2 class="font-game text-lg mb-4 text-white">Tu Progreso</h2>
                    <div class="glass-panel rounded-xl p-6 border-white/10 shadow-xl mb-6">
                        <div class="flex justify-between mb-2"><span class="text-slate-400 text-xs font-bold uppercase">Completado</span><span class="text-white font-bold text-xl">${prog}%</span></div>
                        <div class="w-full h-3 bg-slate-900/50 rounded-full border border-white/10 mb-4 overflow-hidden"><div class="h-full bg-indigo-500 shadow-[0_0_10px_rgba(99,102,241,0.5)]" style="width: ${prog}%"></div></div>
                        <div class="grid grid-cols-3 gap-2 text-center text-xs divide-x divide-white/10">
                            <div><span class="block text-green-400 font-bold text-lg drop-shadow-sm">${completed}</span>Logradas</div>
                            <div><span class="block text-red-400 font-bold text-lg drop-shadow-sm">${skipped}</span>Saltadas</div>
                            <div><span class="block text-slate-400 font-bold text-lg">${gameState.pendingIds.length + gameState.activeIds.length}</span>Restan</div>
                        </div>
                    </div>
                    ${skipped > 0 ? `<h3 class="text-white font-bold mb-3 text-sm text-red-400 flex items-center gap-2"><i data-lucide="alert-circle" class="w-4 h-4"></i> Recuperar Saltadas</h3><div class="space-y-2 mb-8">${gameState.skippedIds.map(id => {
                        const m = getMissionById(id);
                        return `<div class="glass-panel p-3 rounded flex justify-between items-center border-red-500/20"><span class="text-sm text-slate-300 truncate mr-2">${m.title}</span><button onclick="recoverSkipped(${m.id})" class="px-3 py-1 bg-white/10 hover:bg-white/20 text-white text-[10px] font-bold rounded border border-white/5 transition-colors">Recuperar</button></div>`
                    }).join('')}</div>` : ''}
                    <h3 class="text-white font-bold mb-3 text-sm opacity-80 flex items-center gap-2"><i data-lucide="history" class="w-4 h-4"></i> Historial</h3>
                    <div class="space-y-2 max-h-[200px] overflow-y-auto custom-scrollbar">${completed === 0 ? '<p class="text-slate-500 text-sm italic">Sin historial.</p>' : gameState.completedIds.slice().reverse().map(o => `<div class="bg-white/5 p-2 rounded flex justify-between text-xs text-slate-400 border border-white/5"><span>${getMissionById(o.id).title}</span><span>${o.date}</span></div>`).join('')}</div>
                    <div class="mt-8 text-center"><button onclick="if(confirm('¿Borrar?')){localStorage.removeItem('heroRPG_v2_save'); location.reload();}" class="text-red-400/60 text-xs font-bold hover:text-red-400 transition-colors flex items-center justify-center gap-1 mx-auto"><i data-lucide="trash-2" class="w-3 h-3"></i> Reiniciar Progreso</button></div>
                    ${FOOTER_HTML}
                </div>
            `);
        }

        function renderMentorView(c) {
            c.insertAdjacentHTML('beforeend', `
                <div class="text-center mb-6 fade-in"><div class="w-20 h-20 bg-white/5 rounded-full mx-auto flex items-center justify-center border-2 border-indigo-500/30 mb-2 shadow-lg backdrop-blur-sm"><i data-lucide="sparkles" class="w-8 h-8 text-indigo-300 drop-shadow-sm"></i></div><h2 class="font-game text-xl text-white drop-shadow-sm">Mentor</h2></div>
                <div id="chatBox" class="glass-panel rounded-xl p-4 h-[350px] overflow-y-auto mb-4 border-white/10 flex flex-col gap-3 custom-scrollbar"><div class="self-start max-w-[85%]"><span class="bg-indigo-900/60 text-indigo-100 text-sm px-4 py-2 rounded-2xl rounded-tl-sm inline-block border border-indigo-500/20 backdrop-blur-sm shadow-sm">¿En qué puedo ayudarte?</span></div></div>
                <div class="grid grid-cols-2 gap-3 fade-in"><button onclick="addChat('fear')" class="btn-secondary p-3 rounded text-xs font-bold text-slate-300 hover:bg-white/10 hover:text-white transition-colors">Miedo</button><button onclick="addChat('fail')" class="btn-secondary p-3 rounded text-xs font-bold text-slate-300 hover:bg-white/10 hover:text-white transition-colors">Fallo</button><button onclick="addChat('tips')" class="btn-secondary col-span-2 p-3 rounded text-xs font-bold text-indigo-300 hover:bg-white/10 hover:text-white transition-colors border-indigo-500/20">Consejo Liderapia</button></div>
                <div class="h-8"></div>
                ${FOOTER_HTML}
            `);
        }

        // Helpers
        window.renderMissions = () => { currentView = 'missions'; renderView(); };
        window.renderMentor = () => { currentView = 'mentor'; renderView(); };
        window.renderProfile = () => { currentView = 'profile'; renderView(); };
        function updateUI() {
            document.getElementById('currentXp').innerText = gameState.xp;
            document.getElementById('userLevel').innerText = Math.floor(gameState.xp / 500) + 1;
            document.getElementById('statStr').innerText = gameState.stats.Str;
            document.getElementById('statAgi').innerText = gameState.stats.Agi;
            document.getElementById('statInt').innerText = gameState.stats.Int;
            document.getElementById('statCha').innerText = gameState.stats.Cha;
        }
        function showHelp() { toggleModal(true, `<div class="text-center"><h2 class="font-game text-xl text-indigo-400 mb-4">Ayuda</h2><div class="text-left space-y-2 text-sm text-slate-300"><p>1. Completa misiones para ganar XP.</p><p>2. Si saltas una, no ganas puntos pero ves la siguiente.</p><p>3. Recupéralas en tu Perfil.</p><p>4. 80% XP para graduarte.</p></div><button onclick="toggleModal(false)" class="mt-6 w-full py-2 bg-indigo-600 text-white rounded font-bold shadow-lg">OK</button></div>`); }
        function showToast(msg, type) {
            const t = document.createElement('div');
            t.className = `glass-panel border ${type=='success'?'border-green-500/50 text-green-400':'border-slate-500/50 text-slate-300'} px-4 py-2 rounded-lg shadow-xl flex items-center gap-2 slide-up backdrop-blur-md`;
            t.innerHTML = `<i data-lucide="${type=='success'?'check-circle':'alert-circle'}" class="w-4 h-4"></i><span class="text-sm font-bold">${msg}</span>`;
            document.getElementById('toastContainer').appendChild(t);
            lucide.createIcons();
            setTimeout(()=>t.remove(), 3000);
        }
        function toggleModal(show, html=null) {
            const el = document.getElementById('modalOverlay');
            if(html) document.getElementById('dynamicModalBody').innerHTML = html;
            if(show) { el.classList.remove('hidden'); setTimeout(()=>el.classList.remove('opacity-0'),10); } else { el.classList.add('opacity-0'); setTimeout(()=>el.classList.add('hidden'),200); }
        }
        function showConfirmation(title, msg, onConfirm) {
            toggleModal(true, `<h3 class="text-xl font-bold text-white mb-2 font-game">${title}</h3><p class="text-slate-300 mb-6 text-sm">${msg}</p><div class="flex justify-end gap-3"><button onclick="toggleModal(false)" class="px-4 py-2 text-slate-400 text-sm hover:text-white transition-colors">Cancelar</button><button id="confBtn" class="px-5 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded font-bold text-sm shadow-lg transition-colors">Confirmar</button></div>`);
            document.getElementById('confBtn').onclick = () => { onConfirm(); toggleModal(false); };
        }
        const mentorQuotes = { fail: ["Aprende del error.", "Inténtalo de nuevo.", "El fallo es parte del camino."], fear: ["El miedo es normal.", "Hazlo con miedo.", "Valentía es actuar."], tips: ["Escucha más.", "Sonríe siempre.", "Pregunta antes de suponer."] };
        window.addChat = (t) => {
            const b = document.getElementById('chatBox');
            b.insertAdjacentHTML('beforeend', `<div class="self-end max-w-[85%] slide-up mb-2"><span class="bg-white/10 text-white text-xs px-3 py-2 rounded-2xl inline-block backdrop-blur-sm">...</span></div>`);
            b.scrollTop = b.scrollHeight;
            setTimeout(() => {
                b.lastElementChild.remove();
                b.insertAdjacentHTML('beforeend', `<div class="self-start max-w-[90%] slide-up mb-2"><span class="bg-indigo-900/60 text-indigo-100 text-xs px-3 py-2 rounded-2xl border border-indigo-500/20 backdrop-blur-sm shadow-sm">${mentorQuotes[t][Math.floor(Math.random()*mentorQuotes[t].length)]}</span></div>`);
                b.scrollTop = b.scrollHeight;
            }, 600);
        };
        window.showStatInfo = (k) => { const d = STAT_DEFINITIONS[k]; toggleModal(true, `<div class="text-center"><div class="w-16 h-16 rounded-full bg-white/5 mx-auto flex items-center justify-center mb-4 border-2 ${d.color.replace('text','border')} shadow-lg backdrop-blur-sm"><i data-lucide="${d.icon}" class="w-8 h-8 ${d.color}"></i></div><h3 class="text-xl font-bold text-white mb-1">${d.name}</h3><p class="text-xs ${d.color} uppercase font-bold mb-4 tracking-wider">${d.book_concept}</p><p class="text-slate-300 text-sm italic leading-relaxed">"${d.desc}"</p><div class="flex justify-between items-center bg-white/5 p-3 rounded-lg mt-4 border border-white/5"><span class="text-xs text-slate-400 uppercase font-bold">Nivel Actual</span><span class="text-xl font-bold text-white">${gameState.stats[k]}</span></div><button onclick="toggleModal(false)" class="mt-6 w-full py-2 bg-white/10 hover:bg-white/20 text-white rounded font-bold text-sm transition-colors border border-white/5">Entendido</button></div>`); lucide.createIcons(); };
        function launchConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

        initGame();
    </script>
</body>
</html>
